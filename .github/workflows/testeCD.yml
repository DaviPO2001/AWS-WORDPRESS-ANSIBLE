# Nome do workflow, aparece na aba "Actions" do GitHub
name: CD Pipeline

# Define quando o workflow ser√° disparado
on:
  push:                  # dispara em eventos de push
    branches: [ "main", "teste", "develop", "master" ] # apenas quando o push for na branch "main"

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Testar Docker Compose
        run: docker compose version

  deploy:
    runs-on: ubuntu-latest
    needs: test
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Deploy via SSH
        uses: appleboy/ssh-action@v0.1.7
        with:
          host: 52.15.204.67
          username: ubuntu
          key: ${{ secrets.EC2_SSH_KEY }}
          script: |
            apt install docker.io
            apt install docker
            apt install docker-compose-v2
            cd /home/ubuntu/app
            git pull wordpress teste
            docker compose pull
            docker compose up -d